<!DOCTYPE html>
<html>
<head>
    <title>24点解法计算器</title>
    <meta charset="utf-8">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .input-group { margin: 10px 0; }
        input { width: 50px; margin: 0 5px; padding: 5px; }
        button { padding: 8px 15px; background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        #result { margin-top: 20px; }
    </style>
</head>
<body>
    <h2>24点解法计算器</h2>
    <div class="input-group">
        <input type="number" id="num1" required>
        <input type="number" id="num2" required>
        <input type="number" id="num3" required>
        <input type="number" id="num4" required>
    </div>
    <button onclick="calculate()">计算解法</button>
    <div id="result"></div>

    <script>
        function permute(arr) {
            const result = [];
            const used = new Array(arr.length).fill(false);
            function backtrack(path) {
                if (path.length === arr.length) {
                    result.push([...path]);
                    return;
                }
                for (let i = 0; i < arr.length; i++) {
                    if (used[i]) continue;
                    if (i > 0 && arr[i] === arr[i-1] && !used[i-1]) continue;
                    used[i] = true;
                    path.push(arr[i]);
                    backtrack(path);
                    path.pop();
                    used[i] = false;
                }
            }
            backtrack([]);
            return result;
        }

        function* product(...args) {
            if (args.length === 0) yield [];
            else {
                const [head, ...tail] = args;
                for (const h of head) {
                    for (const t of product(...tail)) {
                        yield [h, ...t];
                    }
                }
            }
        }

        const structures = [
            (a, b, c, d, op1, op2, op3) => `((${a}${op1}${b})${op2}${c})${op3}${d}`,
            (a, b, c, d, op1, op2, op3) => `(${a}${op1}(${b}${op2}${c}))${op3}${d}`,
            (a, b, c, d, op1, op2, op3) => `${a}${op1}((${b}${op2}${c})${op3}${d})`,
            (a, b, c, d, op1, op2, op3) => `${a}${op1}(${b}${op2}(${c}${op3}${d}))`,
            (a, b, c, d, op1, op2, op3) => `(${a}${op1}${b})${op3}(${c}${op2}${d})`
        ];

        function find24Solutions(numbers) {
            const solutions = new Set();
            const ops = ['+', '-', '*', '/'];
            const uniquePerms = permute(numbers).map(p => p.map(String));

            for (const [a, b, c, d] of uniquePerms) {
                for (const [op1, op2, op3] of product(ops, ops, ops)) {
                    for (const struct of structures) {
                        try {
                            const expr = struct(a, b, c, d, op1, op2, op3);
                            const value = eval(expr);
                            if (Math.abs(value - 24) < 1e-6) {
                                solutions.add(expr.replace(/(\d+)/g, '$1'));
                            }
                        } catch (e) {
                            continue;
                        }
                    }
                }
            }
            return Array.from(solutions);
        }

        function calculate() {
            const nums = [
                parseInt(document.getElementById('num1').value),
                parseInt(document.getElementById('num2').value),
                parseInt(document.getElementById('num3').value),
                parseInt(document.getElementById('num4').value)
            ];
            
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '';
            
            if (nums.some(isNaN)) {
                resultDiv.innerHTML = '请输入四个有效整数';
                return;
            }

            const solutions = find24Solutions(nums);
            if (solutions.length > 0) {
                resultDiv.innerHTML = '<strong>找到的解法如下：</strong><br>' + 
                    solutions.map((sol, idx) => `${idx+1}. ${sol}`).join('<br>');
            } else {
                resultDiv.innerHTML = '无法找到解法';
            }
        }
    </script>
</body>
</html>
